import{W as g,s as x,P as b,a as S,S as A,D as M,A as v,O as E,C as F,M as f,b as L,c as C,B as z,d as j,F as u,e as m,V as l,L as P,Q as R,f as w,g as N}from"./vendor.308ee55c.js";import"worker-loader!./worker";const B=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const n of a.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerpolicy&&(a.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?a.credentials="include":i.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}};B();class O{constructor(e){this._animations=e}get animations(){return this._animations}}class W{constructor(e){this._Init(e)}intersect(e,t,s,i){var a=Math.sqrt((e.x-s.x)*(e.x-s.x)+(e.y-s.y)*(e.y-s.y)+(e.z-s.z)*(e.z-s.z));return console.log(a),a<t+i}_Init(e){this._params=e,this._decceleration=new l(-5e-4,-1e-4,-5),this._acceleration=new l(1,.25,50),this._velocity=new l(0,0,0),this._animations={},this._input=new U,this._stateMachine=new D(new O(this._animations)),this._LoadModels()}_LoadModels(){const e=new u;e.setPath("./resources/character/"),e.load("character.fbx",t=>{t.children[0].material.transparent=!1,t.scale.setScalar(.1),t.traverse(a=>{a.castShadow=!0}),this._target=t,this._params.scene.add(this._target),this._mixer=new m(this._target),this._manager=new P,this._manager.onLoad=()=>{this._stateMachine.SetState("idle")};const s=(a,n)=>{const c=n.animations[0],r=this._mixer.clipAction(c);this._animations[a]={clip:c,action:r}},i=new u(this._manager);i.setPath("./resources/character/"),i.load("walk3.fbx",a=>{s("walk",a)}),i.load("run3.fbx",a=>{s("run",a)}),i.load("idle3.fbx",a=>{s("idle",a)}),i.load("dance3.fbx",a=>{s("dance",a)})})}Update(e){if(!this._target)return;this._stateMachine.Update(e,this._input);const t=this._velocity,s=new l(t.x*this._decceleration.x,t.y*this._decceleration.y,t.z*this._decceleration.z);s.multiplyScalar(e),s.z=Math.sign(s.z)*Math.min(Math.abs(s.z),Math.abs(t.z)),t.add(s);const i=this._target,a=new R,n=new l,c=i.quaternion.clone(),r=this._acceleration.clone();this._input._keys.shift&&r.multiplyScalar(2),this._stateMachine._currentState.Name=="dance"&&r.multiplyScalar(0),this._input._keys.forward&&(t.z+=r.z*e),this._input._keys.backward&&(t.z-=r.z*e),this._input._keys.left&&(n.set(0,1,0),a.setFromAxisAngle(n,4*Math.PI*e*this._acceleration.y),c.multiply(a)),this._input._keys.right&&(n.set(0,1,0),a.setFromAxisAngle(n,4*-Math.PI*e*this._acceleration.y),c.multiply(a)),i.quaternion.copy(c);const h=new l;h.copy(i.position);var d=new l(0,0,1),y=new w().setFromObject(this._target),k=new w().setFromObject(this._params.scene.children[3]);y.intersectsBox(k)&&(console.log("whoaaa watchout"),d=new l(0,0,0)),d.applyQuaternion(i.quaternion),d.normalize();const _=new l(1,0,0);_.applyQuaternion(i.quaternion),_.normalize(),_.multiplyScalar(t.x*e),d.multiplyScalar(t.z*e),i.position.add(d),i.position.add(_),h.copy(i.position),this._mixer&&this._mixer.update(e)}}class U{constructor(){this._Init()}_Init(){this._keys={forward:!1,backward:!1,left:!1,right:!1,space:!1,shift:!1},document.addEventListener("keydown",e=>this._onKeyDown(e),!1),document.addEventListener("keyup",e=>this._onKeyUp(e),!1)}_onKeyDown(e){switch(e.keyCode){case 87:this._keys.forward=!0;break;case 65:this._keys.left=!0;break;case 83:this._keys.backward=!0;break;case 68:this._keys.right=!0;break;case 32:this._keys.space=!0;break;case 16:this._keys.shift=!0;break}}_onKeyUp(e){switch(e.keyCode){case 87:this._keys.forward=!1;break;case 65:this._keys.left=!1;break;case 83:this._keys.backward=!1;break;case 68:this._keys.right=!1;break;case 32:this._keys.space=!1;break;case 16:this._keys.shift=!1;break}}}class q{constructor(){this._states={},this._currentState=null}_AddState(e,t){this._states[e]=t}SetState(e){const t=this._currentState;if(t){if(t.Name==e)return;t.Exit()}const s=new this._states[e](this);this._currentState=s,s.Enter(t)}Update(e,t){this._currentState&&this._currentState.Update(e,t)}}class D extends q{constructor(e){super();this._proxy=e,this._Init()}_Init(){this._AddState("idle",K),this._AddState("walk",G),this._AddState("run",H),this._AddState("dance",I)}}class p{constructor(e){this._parent=e}Enter(){}Exit(){}Update(){}}class I extends p{constructor(e){super(e);this._FinishedCallback=()=>{this._Finished()}}get Name(){return"dance"}Enter(e){const t=this._parent._proxy._animations.dance.action;if(t.getMixer().addEventListener("finished",this._FinishedCallback),e){const i=this._parent._proxy._animations[e.Name].action;t.reset(),t.setLoop(N,1),t.clampWhenFinished=!0,t.crossFadeFrom(i,.2,!0),t.play()}else t.play()}_Finished(){this._Cleanup(),this._parent.SetState("idle")}_Cleanup(){this._parent._proxy._animations.dance.action.getMixer().removeEventListener("finished",this._CleanupCallback)}Exit(){this._Cleanup()}Update(e){}}class G extends p{constructor(e){super(e)}get Name(){return"walk"}Enter(e){const t=this._parent._proxy._animations.walk.action;if(e){const s=this._parent._proxy._animations[e.Name].action;if(t.enabled=!0,e.Name=="run"){const i=t.getClip().duration/s.getClip().duration;t.time=s.time*i}else t.time=0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1);t.crossFadeFrom(s,.5,!0),t.play()}else t.play()}Exit(){}Update(e,t){if(t._keys.forward||t._keys.backward){t._keys.shift&&this._parent.SetState("run");return}this._parent.SetState("idle")}}class H extends p{constructor(e){super(e)}get Name(){return"run"}Enter(e){const t=this._parent._proxy._animations.run.action;if(e){const s=this._parent._proxy._animations[e.Name].action;if(t.enabled=!0,e.Name=="walk"){const i=t.getClip().duration/s.getClip().duration;t.time=s.time*i}else t.time=0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1);t.crossFadeFrom(s,.5,!0),t.play()}else t.play()}Exit(){}Update(e,t){if(t._keys.forward||t._keys.backward){t._keys.shift||this._parent.SetState("walk");return}this._parent.SetState("idle")}}class K extends p{constructor(e){super(e)}get Name(){return"idle"}Enter(e){const t=this._parent._proxy._animations.idle.action;if(e){const s=this._parent._proxy._animations[e.Name].action;t.time=0,t.enabled=!0,t.setEffectiveTimeScale(1),t.setEffectiveWeight(1),t.crossFadeFrom(s,.5,!0),t.play()}else t.play()}Exit(){}Update(e,t){t._keys.forward||t._keys.backward?this._parent.SetState("walk"):t._keys.space&&this._parent.SetState("dance")}}class Q{constructor(){this._Initialize()}_Initialize(){this._threejs=new g({antialias:!0}),this._threejs.outputEncoding=x,this._threejs.shadowMap.enabled=!0,this._threejs.shadowMap.type=b,this._threejs.setPixelRatio(window.devicePixelRatio),this._threejs.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this._threejs.domElement),window.addEventListener("resize",()=>{this._OnWindowResize()},!1);const e=60,t=1920/1080,s=1,i=1e3;this._camera=new S(e,t,s,i),this._camera.position.set(75,20,0),this._scene=new A;let a=new M(16777215,2);a.position.set(20,100,10),a.target.position.set(0,0,0),a.castShadow=!0,a.shadow.bias=-.001,a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.camera.near=.1,a.shadow.camera.far=500,a.shadow.camera.near=.5,a.shadow.camera.far=500,a.shadow.camera.left=100,a.shadow.camera.right=-100,a.shadow.camera.top=100,a.shadow.camera.bottom=-100,this._scene.add(a),a=new v(16777215,1),this._scene.add(a);const n=new E(this._camera,this._threejs.domElement);n.target.set(0,20,0),n.update(),new F().load(["./resources/background/bluecloud_ft.jpg","./resources/background/bluecloud_bk.jpg","./resources/background/bluecloud_up.jpg","./resources/background/bluecloud_dn.jpg","./resources/background/bluecloud_rt.jpg","./resources/background/bluecloud_lf.jpg"]);const r=new f(new L(300,300,10,10),new C({color:2105376}));r.castShadow=!1,r.receiveShadow=!0,r.rotation.x=-Math.PI/2,this._scene.add(r),this._mixers=[],this._previousRAF=null,this._LoadAnimatedModel(),this._LoadHouseModels(),this._RAF()}_LoadHouseModels(){const e=new z(60,20,1),t=new j({color:16777215}),s=new f(e,t);s.position.set(35,10,20),console.log(s),this._scene.add(s)}_LoadAnimatedModel(){const e={camera:this._camera,scene:this._scene};this._controls=new W(e)}_LoadAnimatedModelAndPlay(e,t,s,i){const a=new u;a.setPath(e),a.load(t,n=>{n.scale.setScalar(.1),n.traverse(r=>{r.castShadow=!0}),n.position.copy(i);const c=new u;c.setPath(e),c.load(s,r=>{const h=new m(n);this._mixers.push(h),h.clipAction(r.animations[0]).play()}),this._scene.add(n)})}_OnWindowResize(){this._camera.aspect=window.innerWidth/window.innerHeight,this._camera.updateProjectionMatrix(),this._threejs.setSize(window.innerWidth,window.innerHeight)}_RAF(){window.requestAnimationFrame(e=>{this._previousRAF===null&&(this._previousRAF=e),this._RAF(),this._threejs.render(this._scene,this._camera),this._Step(e-this._previousRAF),this._previousRAF=e})}_Step(e){const t=e*.001;this._mixers&&this._mixers.map(s=>s.update(t)),this._controls&&this._controls.Update(t)}}window.addEventListener("DOMContentLoaded",()=>{new Q});
